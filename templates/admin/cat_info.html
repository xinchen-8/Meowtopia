<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理員-管理頁面</title>
    <link rel="stylesheet" href="{{ url_for('static', filename = 'styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename = 'cat.css') }}">
</head>
<body class="admin">
    <div class="layout">
        <header class="header">
            <a class="logo" href="{{ url_for('home') }}">喵托邦</a>
            <nav class="auth-buttons">
                <a href="{{ url_for('logout') }}" class="auth-buttons">登出</a>
            </nav>
        </header>

        <!-- Sidebar -->
        <nav class="sidebar">
            <ul>
                <li>
                    <a class="sidebar-button" href="{{ url_for('admin_cat_info') }}">貓咪管理</a>
                </li>
                <li>
                    <a class="sidebar-button" href="{{ url_for('admin_request_review') }}">領養申請審核</a>
                </li>
            </ul>
        </nav>

        <!-- 搜尋表單 -->
        <div class="search-container">
            <form method="POST" action="{{ url_for('admin_cat_info') }}" class="search-form">
                <div class="search-group">
                    <label class="search-label" for="cat_name">貓咪名稱</label>
                    <input type="text" name="cat_name" class="search-input" id="cat_name">
                </div>
                <div class="search-group">
                    <label class="search-label" for="cat_gender">性別</label>
                    <select name="cat_gender" class="search-input" id="cat_gender">
                        <option value="">全部</option>
                        <option value="公">公</option>
                        <option value="母">母</option>
                    </select>
                </div>
                <div class="search-group">
                    <label class="search-label" for="cat_age">年齡</label>
                    <input type="number" name="cat_age" class="search-input" id="cat_age" min="0">
                </div>
                <button type="submit" class="search-button">搜尋</button>
            </form>
        </div>
        <div class="container">
            <div class="card-grid">
                {% for cat in cats.items %}
                    <div class="card">
                        <div class="card-image">
                            <img src="/api/placeholder/280/200" alt="{{ cat.name }}">
                            <div class="card-favorite">♡</div>
                        </div>
                        <div class="card-content">
                            <h2 class="card-title">{{ cat.name }}</h2>
                            <div class="card-tags">
                                <span class="tag">{{ cat.age }}歲</span>
                                <span class="tag">{{ cat.gender }}</span>
                            </div>
                            <p class="card-description">{{ cat.description }}</p>
                            <button class="card-button" data-cat-id="{{ cat.id }}">了解更多</button>
                        </div>
                    </div>
                {% endfor %}

                <div class="card-grid">
                {% for cat in cats.items %}
                    <div class="card">
                        <div class="card-image">
                            <img src="/api/placeholder/280/200" alt="{{ cat.name }}">
                            <div class="card-favorite">♡</div>
                        </div>
                        <div class="card-content">
                            <h2 class="card-title">{{ cat.name }}</h2>
                            <div class="card-tags">
                                <span class="tag">{{ cat.age }}歲</span>
                                <span class="tag">{{ cat.gender }}</span>
                            </div>
                            <p class="card-description">{{ cat.description }}</p>
                            <button class="card-button" data-cat-id="{{ cat.id }}">了解更多</button>
                        </div>
                    </div>
                {% endfor %}
                {% for cat in globalcats.items %}
                    <div class="card">
                        <div class="card-image">
                            <img src="/api/placeholder/280/200" alt="{{ cat.name }}">
                            <div class="card-favorite">♡</div>
                        </div>
                        <div class="card-content">
                            <h2 class="card-title">{{ cat.name }}</h2>
                            <div class="card-tags">
                                <span class="tag">{{ cat.age }}歲</span>
                                <span class="tag">{{ cat.gender }}</span>
                            </div>
                            <p class="card-description">{{ cat.description }}</p>
                            <button class="card-button" data-cat-id="{{ cat.id }}">了解更多</button>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <!-- 分頁按鈕 -->
            <div class="pagination">
                {% if cats.has_prev %}
                    <a href="{{ url_for('admin_cat_info', page=cats.prev_num) }}">上一頁</a>
                {% endif %}
                <span>頁數: {{ cats.page }} / {{ cats.pages }}</span>
                {% if cats.has_next %}
                    <a href="{{ url_for('admin_cat_info', page=cats.next_num) }}">下一頁</a>
                {% endif %}
            </div>
        </div>
        <!-- Modal HTML 結構 -->
        <div class="modal-overlay" id="catModal">
            <div class="modal-content">
                <button class="modal-close">&times;</button>
                <div class="modal-body">
                    <div class="cat-info">
                        <h2 id="modalCatName"></h2>
                        <div class="info-item">
                            <span class="info-label">年齡：</span>
                            <span class="info-value" id="modalCatAge"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">性別：</span>
                            <span class="info-value" id="modalCatGender"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">品種：</span>
                            <span class="info-value" id="modalCatBreed"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">健康狀況：</span>
                            <span class="info-value" id="modalCatHealth"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">性格：</span>
                            <span class="info-value" id="modalCatPersonality"></span>
                        </div>
                    </div>
                    <div class="contact-info">
                        <h3>聯絡資訊</h3>
                        <div class="contact-details">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 修改 JavaScript -->
    <script>
    async function openModal(catId) {
        try {
            // 獲取貓咪詳細信息
            const response = await fetch(`/api/cat/${catId}`);
            const catData = await response.json();

            // 更新 Modal 內容
            document.getElementById('modalCatName').textContent = catData.cat.name;
            document.getElementById('modalCatAge').textContent = `${catData.cat.age}歲`;
            document.getElementById('modalCatGender').textContent = catData.cat.gender;
            document.getElementById('modalCatBreed').textContent = catData.cat.breed || '未知';  // 若無品種資料可設為 "未知"
            document.getElementById('modalCatHealth').textContent = catData.cat.health_status;
            document.getElementById('modalCatPersonality').textContent = catData.cat.personality;

            // 更新聯絡資訊
            document.querySelector('.contact-details').innerHTML = `
                <p>聯絡人：${catData.user_contact}</p>
                <p>聯絡方式：${catData.user_contact}</p>
            `;

            // 顯示 Modal
            const modal = document.getElementById('catModal');
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        } catch (error) {
            console.error('Error fetching cat details:', error);
            alert('無法獲取貓咪資料，請稍後再試');
        }
    }


    // 關閉 Modal
    function closeModal() {
        const modal = document.getElementById('catModal');
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    // 點擊背景關閉
    document.querySelector('.modal-overlay').addEventListener('click', (e) => {
        if (e.target.classList.contains('modal-overlay')) {
            closeModal();
        }
    });

    // 關閉按鈕
    document.querySelector('.modal-close').addEventListener('click', closeModal);

    // 綁定卡片上的按鈕
    document.querySelectorAll('.card-button').forEach(button => {
        button.addEventListener('click', () => {
            const catId = button.dataset.catId;
            openModal(catId);
        });
    });
    </script>
</body>
</html>